<?php
session_start();
include 'connect.php';

// Check if admin is logged in
if(!isset($_SESSION['role']) || $_SESSION['role'] !== 'admin'){
    header("Location: login.php");
    exit();
}

// Get the team member ID
$id = intval($_GET['id'] ?? 0);
if($id <= 0){
    header("Location: admin_crud.php");
    exit();
}

// Fetch the team member data
$result = $conn->query("SELECT * FROM team_members WHERE id=$id");
$team = $result->fetch_assoc();
if(!$team){
    echo "Team member not found!";
    exit();
}

// Handle form submission
if(isset($_POST['update'])){
    $name = $conn->real_escape_string($_POST['name']);
    $position = $conn->real_escape_string($_POST['position']);
    
    // Handle file upload
    if(!empty($_FILES['photo']['name'])){
        $photo = time() . '_' . $_FILES['photo']['name'];
        move_uploaded_file($_FILES['photo']['tmp_name'], "uploads/$photo");
    } else {
        $photo = $team['photo']; // Keep old photo
    }

    $conn->query("UPDATE team_members SET name='$name', position='$position', photo='$photo', updated_at=CURRENT_TIMESTAMP WHERE id=$id");
    header("Location: admin_crud.php");
    exit();
}
?>

<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Edit Team Member</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
form { max-width: 500px; margin: auto; }
label { display: block; margin: 10px 0 5px; }
input[type=text], input[type=file] { width: 100%; padding: 8px; }
button { margin-top: 15px; padding: 10px 15px; }
img { margin-top: 10px; border-radius: 5px; }
</style>
</head>
<body>
<h1>Edit Team Member</h1>
<form method="post" enctype="multipart/form-data">
<label>Name</label>
<input type="text" name="name" value="<?= htmlspecialchars($team['name'] ?? '') ?>" required>

<label>Position</label> <input type="text" name="position" value="<?= htmlspecialchars($team['position'] ?? '') ?>" required>

<label>Photo</label> <input type="file" name="photo">

<?php if(!empty($team['photo'])): ?>

<img src="uploads/<?= htmlspecialchars($team['photo']) ?>" width="100" alt="Photo">
<?php endif; ?>

<button type="submit" name="update">Update</button>

</form>
</body>
</html>
